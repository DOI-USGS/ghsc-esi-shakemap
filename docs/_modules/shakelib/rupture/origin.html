
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>shakelib.rupture.origin &#8212; ShakeMap Documentation  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for shakelib.rupture.origin</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># stdlib imports</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="c1"># third party</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">import</span> <span class="nn">defusedxml.ElementTree</span> <span class="k">as</span> <span class="nn">dET</span>
<span class="kn">from</span> <span class="nn">openquake.hazardlib.geo</span> <span class="kn">import</span> <span class="n">point</span>
<span class="kn">from</span> <span class="nn">obspy.io.quakeml.core</span> <span class="kn">import</span> <span class="n">_is_quakeml</span>
<span class="kn">from</span> <span class="nn">obspy.core.event</span> <span class="kn">import</span> <span class="n">read_events</span>
<span class="kn">from</span> <span class="nn">strec.tensor</span> <span class="kn">import</span> <span class="n">fill_tensor_from_components</span>

<span class="kn">from</span> <span class="nn">impactutils.time.ancient_time</span> <span class="kn">import</span> <span class="n">HistoricTime</span>
<span class="kn">from</span> <span class="nn">shakelib.utils.exception</span> <span class="kn">import</span> <span class="n">ShakeLibException</span>
<span class="kn">from</span> <span class="nn">shakelib.rupture</span> <span class="kn">import</span> <span class="n">constants</span>


<div class="viewcode-block" id="Origin"><a class="viewcode-back" href="../../../shakelib/shakelib.rupture.origin.html#shakelib.rupture.origin.Origin">[docs]</a><span class="k">class</span> <span class="nc">Origin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The purpose of this class is to read/store event origin information,</span>
<span class="sd">    which is usually derived from an xml file called &quot;event.xml&quot;. There is</span>
<span class="sd">    also a mechanism to overwrite information in event.xml with a file in</span>
<span class="sd">    the input directory called &quot;source.txt&quot;.</span>

<span class="sd">    Note that this class is generally contained within a Rupture instance.</span>

<span class="sd">    Event values are:</span>

<span class="sd">        - id: the event id.</span>
<span class="sd">        - netid: the source network code</span>
<span class="sd">        - network: a string describing the source network</span>
<span class="sd">        - lat: hypocenter latitude (decimal degrees; -90 to 90).</span>
<span class="sd">        - lon: hypocenter longitude (decimal degrees; -180 to 180).</span>
<span class="sd">        - depth: hypocenter depth (km, positive down).</span>
<span class="sd">        - locstring: a free-form descriptive string of location.</span>
<span class="sd">        - mag: earthquake magnitude.</span>
<span class="sd">        - time: a HistoricTime object containing the origin date/time</span>
<span class="sd">        - mech: a string specifying the rupture mechanism; the accepted types</span>
<span class="sd">          are RS, SS, NM, and ALL, for reverse slip, strike slip, normal, and</span>
<span class="sd">          unspecified ruptures, respectively.</span>
<span class="sd">        - reference: A string describing the data source (optional)</span>
<span class="sd">        - productcode: The PDL product code for this ShakeMap</span>

<span class="sd">    For backward-compatibility, we also check for &#39;type&#39;. If both &#39;mech&#39; and</span>
<span class="sd">    &#39;type&#39; are missing (or empty strings) then &#39;mech&#39; is set to ALL.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct an Origin object.</span>

<span class="sd">        Args:</span>
<span class="sd">            event (dict): Dictionary of values. See list above for required</span>
<span class="sd">            keys.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Origin object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: When one or more required values are missing from the</span>
<span class="sd">                      event object.</span>
<span class="sd">            TypeError: If the event ID is not a string.</span>
<span class="sd">            ValueError: If the latitude or longitude are outside of the</span>
<span class="sd">                        allowed ranges, or if the &#39;mech&#39; value is not</span>
<span class="sd">                        an allowed type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Check for missing keys</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ekeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ORIGIN_REQUIRED_KEYS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">req</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ekeys</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Input event dictionary is missing the following &#39;</span>
                           <span class="s1">&#39;required keys: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)))</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Check some types, ranges, and defaults</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;event id  must be a string.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lat must be between -90 and 90 degrees.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lon must be between -180 and 180 degrees.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">ekeys</span> <span class="ow">and</span> <span class="s1">&#39;mech&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ekeys</span><span class="p">:</span>
            <span class="n">event</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;mech&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">event</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_MECH</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">RAKEDICT</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;mech must be SS, NM, RS, or ALL.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">DEFAULT_MECH</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="c1"># Add keys as class attributes</span>
        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;rake&#39;</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="c1"># What about rake?</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;rake&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rake</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">RAKEDICT</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mech</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rake</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rake</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span>

<div class="viewcode-block" id="Origin.fromFile"><a class="viewcode-back" href="../../../shakelib/shakelib.rupture.origin.html#shakelib.rupture.origin.Origin.fromFile">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromFile</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">eventxmlfile</span><span class="p">,</span> <span class="n">sourcefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">momentfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Class method to create a Origin object by specifying an event.xml</span>
<span class="sd">        file, a rupture file, a source.txt file, and a moment.xml file.</span>

<span class="sd">        Args:</span>
<span class="sd">            eventxmlfile (str): Event xml file (see read_event_file()).</span>
<span class="sd">            sourcefile (str): source.txt file (see read_source()).</span>
<span class="sd">            momentfile (str): moment.xml file (see read_moment_quakeml()).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Origin object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">read_event_file</span><span class="p">(</span><span class="n">eventxmlfile</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sourcefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">read_source</span><span class="p">(</span><span class="n">sourcefile</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">momentfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">read_moment_quakeml</span><span class="p">(</span><span class="n">momentfile</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="Origin.getHypo"><a class="viewcode-back" href="../../../shakelib/shakelib.rupture.origin.html#shakelib.rupture.origin.Origin.getHypo">[docs]</a>    <span class="k">def</span> <span class="nf">getHypo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">           Hypocenter as OpenQuake Point instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">point</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span></div>

<div class="viewcode-block" id="Origin.setMechanism"><a class="viewcode-back" href="../../../shakelib/shakelib.rupture.origin.html#shakelib.rupture.origin.Origin.setMechanism">[docs]</a>    <span class="k">def</span> <span class="nf">setMechanism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mech</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rake</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the earthquake mechanism manually (overriding any values read</span>
<span class="sd">        in from event.xml or source.txt. If rake and dip are not specified,</span>
<span class="sd">        they will be assigned by mechanism as follows:</span>

<span class="sd">        +-------+--------+-----+</span>
<span class="sd">        | Mech  |  Rake  | Dip |</span>
<span class="sd">        +=======+========+=====+</span>
<span class="sd">        | RS    |    90  |  40 |</span>
<span class="sd">        +-------+--------+-----+</span>
<span class="sd">        | NM    |   -90  |  50 |</span>
<span class="sd">        +-------+--------+-----+</span>
<span class="sd">        | SS    |     0  |  90 |</span>
<span class="sd">        +-------+--------+-----+</span>
<span class="sd">        | ALL   |    45  |  90 |</span>
<span class="sd">        +-------+--------+-----+</span>

<span class="sd">        Args:</span>
<span class="sd">            mech (str): One of &#39;RS&#39; (reverse), &#39;NM&#39; (normal), &#39;SS&#39; (strike</span>
<span class="sd">                slip), or &#39;ALL&#39; (unknown).</span>
<span class="sd">            rake (float): Value between -360 and 360 degrees. If set, will</span>
<span class="sd">                override default value for mechanism (see table above).</span>
<span class="sd">            dip (float): Value betweeen 0 and 90 degrees. If set, will override</span>
<span class="sd">                default value for mechanism (see table above). Value will be</span>
<span class="sd">                converted to range between -180 and 180 degrees.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mechs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RS&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rake&#39;</span><span class="p">:</span> <span class="mf">90.0</span><span class="p">,</span> <span class="s1">&#39;dip&#39;</span><span class="p">:</span> <span class="mf">40.0</span><span class="p">},</span>
                 <span class="s1">&#39;NM&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rake&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="s1">&#39;dip&#39;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">},</span>
                 <span class="s1">&#39;SS&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rake&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;dip&#39;</span><span class="p">:</span> <span class="mf">90.0</span><span class="p">},</span>
                 <span class="s1">&#39;ALL&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rake&#39;</span><span class="p">:</span> <span class="mf">45.0</span><span class="p">,</span> <span class="s1">&#39;dip&#39;</span><span class="p">:</span> <span class="mf">90.0</span><span class="p">}}</span>

        <span class="k">if</span> <span class="n">mech</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">mechs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">ShakeLibException</span><span class="p">(</span>
                <span class="s1">&#39;Mechanism must be one of: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">mechs</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>

        <span class="k">if</span> <span class="n">dip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dip</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dip</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Dip must be in range 0-90 degrees.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dip</span> <span class="o">=</span> <span class="n">mechs</span><span class="p">[</span><span class="n">mech</span><span class="p">][</span><span class="s1">&#39;dip&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rake</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rake</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span>
                <span class="n">rake</span> <span class="o">+=</span> <span class="mi">360</span>
            <span class="k">if</span> <span class="n">rake</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="n">rake</span> <span class="o">-=</span> <span class="mi">360</span>
            <span class="k">if</span> <span class="n">rake</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span> <span class="ow">or</span> <span class="n">rake</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s1">&#39;Rake must be transformable to be in range -180 to 180 &#39;</span>
                    <span class="s1">&#39;degrees.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rake</span> <span class="o">=</span> <span class="n">mechs</span><span class="p">[</span><span class="n">mech</span><span class="p">][</span><span class="s1">&#39;rake&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dip</span> <span class="o">=</span> <span class="n">dip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rake</span> <span class="o">=</span> <span class="n">rake</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mech</span> <span class="o">=</span> <span class="n">mech</span>
        <span class="k">return</span></div></div>


<div class="viewcode-block" id="write_event_file"><a class="viewcode-back" href="../../../shakelib/shakelib.rupture.origin.html#shakelib.rupture.origin.write_event_file">[docs]</a><span class="k">def</span> <span class="nf">write_event_file</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">xmlfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write event.xml file.</span>

<span class="sd">    Args:</span>
<span class="sd">       event (dict): Dictionary containing fields [field, (type, example)]:</span>

<span class="sd">           - id (str, &quot;us2008abcd&quot;)</span>
<span class="sd">           - netid (str, &quot;us&quot;)</span>
<span class="sd">           - network (str, &quot;USGS National Network&quot;)</span>
<span class="sd">           - lat (float, 42.1234)</span>
<span class="sd">           - lon (float, -85.1234)</span>
<span class="sd">           - depth (float, 24.1)</span>
<span class="sd">           - mag (float, 7.9)</span>
<span class="sd">           - time (HistoricTime object)</span>
<span class="sd">           - locstring (str, &quot;East of the Poconos&quot;)</span>
<span class="sd">           - mech (str, &quot;RS&quot;, &quot;SS&quot;, &quot;NM&quot;, or &#39;ALL&#39;) (optional)</span>
<span class="sd">           - reference (str, data source: &#39;Smith et al. 2016&#39;) (optional)</span>
<span class="sd">           - event_type (str, &#39;ACTUAL&#39; or &#39;SCENARIO&#39;) (optional)</span>
<span class="sd">           - productcode (str, &#39;us2000wxyz_zoom&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        nothing: Nothing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;earthquake&#39;</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;netid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;netid&#39;</span><span class="p">]</span>
        <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">]</span>
        <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
        <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
        <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span>
        <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span>
        <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">ALT_TIMEFMT</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;locstring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;locstring&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;mech&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;reference&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;productcode&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;productcode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;productcode&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;event_type&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ACTUAL&#39;</span><span class="p">,</span> <span class="s1">&#39;SCENARIO&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s1">&#39;event_type must be &quot;ACTUAL&quot; or &quot;SCENARIO&quot;&#39;</span><span class="p">)</span>
            <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ACTUAL&#39;</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xmlfile</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="read_event_file"><a class="viewcode-back" href="../../../shakelib/shakelib.rupture.origin.html#shakelib.rupture.origin.read_event_file">[docs]</a><span class="k">def</span> <span class="nf">read_event_file</span><span class="p">(</span><span class="n">eventxml</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read event.xml file from disk, returning a dictionary of attributes.</span>
<span class="sd">    Input XML format looks like this (all elements are required unless</span>
<span class="sd">    explicitly labeled optional):</span>

<span class="sd">    .. code-block:: xml</span>

<span class="sd">         &lt;earthquake</span>
<span class="sd">             id=&quot;2008ryan&quot;</span>
<span class="sd">             netid=&quot;us&quot;</span>
<span class="sd">             network=&quot;USGS National Network&quot; (required but may be empty string)</span>
<span class="sd">             lat=&quot;30.9858&quot;</span>
<span class="sd">             lon=&quot;103.3639&quot;</span>
<span class="sd">             mag=&quot;7.9&quot;</span>
<span class="sd">             depth=&quot;19.0&quot;</span>
<span class="sd">             time=&quot;YYYY-mm-ddTHH:MM:SS.ffffffZ&quot; (omitting fractional seconds</span>
<span class="sd">                                                is also supported)</span>
<span class="sd">             locstring=&quot;EASTERN SICHUAN, CHINA&quot;</span>
<span class="sd">             mech=&#39;SS&#39; | &#39;NM&#39; | &#39;RS&#39; | &#39;ALL&#39; (optional)</span>
<span class="sd">             reference=&quot;Smith et al. 2016&quot; (optional)</span>
<span class="sd">             productcode=&#39;us2008ryan&#39; (optional)</span>
<span class="sd">         /&gt;</span>

<span class="sd">    Args:</span>
<span class="sd">        eventxml (str): Path to event XML file OR file-like object.</span>

<span class="sd">    Returns:</span>
<span class="sd">       dict: Dictionary with keys:</span>
<span class="sd">         - id: Origin network and origin code (i.e., us2017abcd).</span>
<span class="sd">         - netid: Origin network (&quot;us&quot;).</span>
<span class="sd">         - network: (A long-form description of the network)</span>
<span class="sd">         - lat: Origin latitude</span>
<span class="sd">         - lon: Origin longitude</span>
<span class="sd">         - mag: Origin magnitude</span>
<span class="sd">         - depth: Origin depth</span>
<span class="sd">         - time: Origin time as an HistoricTime object.</span>
<span class="sd">         - locstring: Location string</span>
<span class="sd">         - mech: (optional) Moment mechanism, one of:</span>
<span class="sd">           - &#39;RS&#39; (Reverse)</span>
<span class="sd">           - &#39;SS&#39; (Strike-Slip)</span>
<span class="sd">           - &#39;NM&#39; (Normal)</span>
<span class="sd">           - &#39;ALL&#39; (Undetermined)</span>
<span class="sd">         - reference: (optional) A description of the source of the data.</span>
<span class="sd">         - productcode: (optional) This product source&#39;s unique code for this</span>
<span class="sd">                        particular ShakeMap.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the time string cannot be parsed into a datetime object</span>
<span class="sd">        KeyError: If any of the required attributes are missing from event.xml</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eventxml</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">dET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">eventxml</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">eventxml</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">dET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Turn XML content into dictionary</span>
    <span class="k">if</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;earthquake&#39;</span><span class="p">:</span>
        <span class="n">xmldict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;earthquake&#39;</span><span class="p">)</span>
        <span class="n">xmldict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">eq</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="n">eqdict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1">#########################################################</span>
    <span class="c1"># A Short Primer on PDL-style Identifiers</span>
    <span class="c1"># Because Everybody (Including The Author) Forgets It.</span>
    <span class="c1">#</span>
    <span class="c1"># In PDL, there are 4 identifiers that fully specify a product:</span>
    <span class="c1"># - source The network that generated the *product* (us, ci, etc.).</span>
    <span class="c1"># - code   The unique ID string that identifies this product,</span>
    <span class="c1">#          usually prepended by *source* (us2008abcd).</span>
    <span class="c1"># - eventsource The network that created the *origin* (us, ci, etc.)</span>
    <span class="c1"># - eventsourcecode The code within that network that uniquely</span>
    <span class="c1">#                   identifies the event (2008abcd).</span>
    <span class="c1">#</span>
    <span class="c1"># For our purposes, we&#39;re storing *source* and *code* as</span>
    <span class="c1"># *productsource* and *productcode* respectively in the</span>
    <span class="c1"># container, in an effort to reduce confusion about their</span>
    <span class="c1"># meaning. Time will tell.</span>
    <span class="c1">#########################################################</span>

    <span class="c1"># read in the id fields</span>
    <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    <span class="c1"># This isn&#39;t optional, but maybe it isn&#39;t in some old files</span>
    <span class="k">if</span> <span class="s1">&#39;network&#39;</span> <span class="ow">in</span> <span class="n">xmldict</span><span class="p">:</span>
        <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;netid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;netid&#39;</span><span class="p">]</span>

    <span class="c1"># look for the productcode attribute in the xml,</span>
    <span class="c1"># otherwise use the event id</span>
    <span class="k">if</span> <span class="s1">&#39;productcode&#39;</span> <span class="ow">in</span> <span class="n">xmldict</span><span class="p">:</span>
        <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;productcode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;productcode&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eventxml</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;productcode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># It&#39;s up to the user of this data how to construct the</span>
        <span class="c1"># product code</span>
        <span class="k">pass</span>

    <span class="c1"># Support old event file date/times</span>
    <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">xmldict</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HistoricTime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                <span class="n">constants</span><span class="o">.</span><span class="n">TIMEFMT</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HistoricTime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                    <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                    <span class="n">constants</span><span class="o">.</span><span class="n">ALT_TIMEFMT</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t convert </span><span class="si">%s</span><span class="s2"> to HistoricTime&quot;</span> <span class="o">%</span>
                                 <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;year&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xmldict</span> <span class="ow">or</span> <span class="s1">&#39;month&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xmldict</span> <span class="ow">or</span> \
           <span class="s1">&#39;day&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xmldict</span> <span class="ow">or</span> <span class="s1">&#39;hour&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xmldict</span> <span class="ow">or</span> \
           <span class="s1">&#39;minute&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xmldict</span> <span class="ow">or</span> <span class="s1">&#39;second&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">xmldict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing date/time elements in event file.&quot;</span><span class="p">)</span>
        <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HistoricTime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span>
            <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span>
            <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span>
            <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">],</span>
            <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span>
            <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;minute&#39;</span><span class="p">],</span>
            <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;second&#39;</span><span class="p">])</span>

    <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
    <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
    <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">])</span>
    <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">])</span>
    <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;locstring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;locstring&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;mech&#39;</span> <span class="ow">in</span> <span class="n">xmldict</span><span class="p">:</span>
        <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;mech&#39;</span><span class="p">]</span>
    <span class="c1"># Older files may have &quot;type&quot; instead of &quot;mech&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">xmldict</span><span class="p">:</span>
        <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;reference&#39;</span> <span class="ow">in</span> <span class="n">xmldict</span><span class="p">:</span>
        <span class="n">eqdict</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmldict</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">eqdict</span></div>


<div class="viewcode-block" id="read_moment_quakeml"><a class="viewcode-back" href="../../../shakelib/shakelib.rupture.origin.html#shakelib.rupture.origin.read_moment_quakeml">[docs]</a><span class="k">def</span> <span class="nf">read_moment_quakeml</span><span class="p">(</span><span class="n">momentfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read moment parameters from a QuakeML file.</span>

<span class="sd">    Args:</span>
<span class="sd">        momentfile (str): Path to a QuakeML file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Empty if momentfile is somehow not valid, or:</span>
<span class="sd">              - moment:</span>
<span class="sd">                  - T:</span>
<span class="sd">                    - azimuth</span>
<span class="sd">                    - plunge</span>
<span class="sd">                  - N:</span>
<span class="sd">                    - azimuth</span>
<span class="sd">                    - plunge</span>
<span class="sd">                  - P:</span>
<span class="sd">                    - azimuth</span>
<span class="sd">                    - plunge</span>
<span class="sd">                  - NP1:</span>
<span class="sd">                    - strike: float</span>
<span class="sd">                    - dip: float</span>
<span class="sd">                    - rake: float</span>
<span class="sd">                  - NP2:</span>
<span class="sd">                    - strike: float</span>
<span class="sd">                    - dip: float</span>
<span class="sd">                    - rake: float</span>
<span class="sd">                  - type: string</span>
<span class="sd">                  - source: string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_quakeml</span><span class="p">(</span><span class="n">momentfile</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="c1"># obspy spits out a bunch of warnings we don&#39;t care about</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="n">catalog</span> <span class="o">=</span> <span class="n">read_events</span><span class="p">(</span><span class="n">momentfile</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalog</span><span class="o">.</span><span class="n">events</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">params</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">focal_mechanisms</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">params</span>
    <span class="n">focal</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">focal_mechanisms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># get the source and type information, if possible</span>
    <span class="n">mtype</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
    <span class="k">if</span> <span class="n">focal</span><span class="o">.</span><span class="n">method_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mtype</span> <span class="o">=</span> <span class="n">focal</span><span class="o">.</span><span class="n">method_id</span>

    <span class="n">msource</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span>
    <span class="k">if</span> <span class="n">focal</span><span class="o">.</span><span class="n">creation_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">focal</span><span class="o">.</span><span class="n">creation_info</span><span class="o">.</span><span class="n">agency_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msource</span> <span class="o">=</span> <span class="n">focal</span><span class="o">.</span><span class="n">creation_info</span><span class="o">.</span><span class="n">agency_id</span>

    <span class="k">if</span> <span class="n">focal</span><span class="o">.</span><span class="n">nodal_planes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">params</span>
    <span class="k">if</span> <span class="n">focal</span><span class="o">.</span><span class="n">nodal_planes</span><span class="o">.</span><span class="n">nodal_plane_1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">focal</span><span class="o">.</span><span class="n">moment_tensor</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">m_rr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mrr</span> <span class="o">=</span> <span class="n">focal</span><span class="o">.</span><span class="n">moment_tensor</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">m_rr</span>
            <span class="n">mtt</span> <span class="o">=</span> <span class="n">focal</span><span class="o">.</span><span class="n">moment_tensor</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">m_tt</span>
            <span class="n">mpp</span> <span class="o">=</span> <span class="n">focal</span><span class="o">.</span><span class="n">moment_tensor</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">m_pp</span>
            <span class="n">mrt</span> <span class="o">=</span> <span class="n">focal</span><span class="o">.</span><span class="n">moment_tensor</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">m_rt</span>
            <span class="n">mrp</span> <span class="o">=</span> <span class="n">focal</span><span class="o">.</span><span class="n">moment_tensor</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">m_rp</span>
            <span class="n">mtp</span> <span class="o">=</span> <span class="n">focal</span><span class="o">.</span><span class="n">moment_tensor</span><span class="o">.</span><span class="n">tensor</span><span class="o">.</span><span class="n">m_tp</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">fill_tensor_from_components</span><span class="p">(</span>
                <span class="n">mrr</span><span class="p">,</span> <span class="n">mtt</span><span class="p">,</span>
                <span class="n">mpp</span><span class="p">,</span> <span class="n">mrt</span><span class="p">,</span>
                <span class="n">mrp</span><span class="p">,</span> <span class="n">mtp</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">msource</span><span class="p">,</span>
                <span class="n">mtype</span><span class="o">=</span><span class="n">mtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plane1</span> <span class="o">=</span> <span class="n">focal</span><span class="o">.</span><span class="n">nodal_planes</span><span class="o">.</span><span class="n">nodal_plane_1</span>
        <span class="n">plane2</span> <span class="o">=</span> <span class="n">focal</span><span class="o">.</span><span class="n">nodal_planes</span><span class="o">.</span><span class="n">nodal_plane_2</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;NP1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;strike&#39;</span><span class="p">:</span> <span class="n">plane1</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span>
            <span class="s1">&#39;dip&#39;</span><span class="p">:</span> <span class="n">plane1</span><span class="o">.</span><span class="n">dip</span><span class="p">,</span>
            <span class="s1">&#39;rake&#39;</span><span class="p">:</span> <span class="n">plane1</span><span class="o">.</span><span class="n">rake</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;NP2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;strike&#39;</span><span class="p">:</span> <span class="n">plane2</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span>
            <span class="s1">&#39;dip&#39;</span><span class="p">:</span> <span class="n">plane2</span><span class="o">.</span><span class="n">dip</span><span class="p">,</span>
            <span class="s1">&#39;rake&#39;</span><span class="p">:</span> <span class="n">plane2</span><span class="o">.</span><span class="n">rake</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;azimuth&#39;</span><span class="p">:</span> <span class="n">focal</span><span class="o">.</span><span class="n">principal_axes</span><span class="o">.</span><span class="n">t_axis</span><span class="o">.</span><span class="n">azimuth</span><span class="p">,</span>
            <span class="s1">&#39;plunge&#39;</span><span class="p">:</span> <span class="n">focal</span><span class="o">.</span><span class="n">principal_axes</span><span class="o">.</span><span class="n">t_axis</span><span class="o">.</span><span class="n">plunge</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;azimuth&#39;</span><span class="p">:</span> <span class="n">focal</span><span class="o">.</span><span class="n">principal_axes</span><span class="o">.</span><span class="n">n_axis</span><span class="o">.</span><span class="n">azimuth</span><span class="p">,</span>
            <span class="s1">&#39;plunge&#39;</span><span class="p">:</span> <span class="n">focal</span><span class="o">.</span><span class="n">principal_axes</span><span class="o">.</span><span class="n">n_axis</span><span class="o">.</span><span class="n">plunge</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;azimuth&#39;</span><span class="p">:</span> <span class="n">focal</span><span class="o">.</span><span class="n">principal_axes</span><span class="o">.</span><span class="n">p_axis</span><span class="o">.</span><span class="n">azimuth</span><span class="p">,</span>
            <span class="s1">&#39;plunge&#39;</span><span class="p">:</span> <span class="n">focal</span><span class="o">.</span><span class="n">principal_axes</span><span class="o">.</span><span class="n">p_axis</span><span class="o">.</span><span class="n">plunge</span>
        <span class="p">}</span>

    <span class="n">moment</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;moment&#39;</span><span class="p">:</span> <span class="n">params</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">moment</span></div>


<div class="viewcode-block" id="read_source"><a class="viewcode-back" href="../../../shakelib/shakelib.rupture.origin.html#shakelib.rupture.origin.read_source">[docs]</a><span class="k">def</span> <span class="nf">read_source</span><span class="p">(</span><span class="n">sourcefile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read source.txt file, which has lines like key=value.</span>

<span class="sd">    Args:</span>
<span class="sd">        sourcefile: Path to source.txt file OR file-like object</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary containing key/value pairs from file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">isFile</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sourcefile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sourcefile</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">isFile</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">sourcefile</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># see if this is some sort of number</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">isFile</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">params</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/northridge_thumbnail_light_16x9.png" alt="Logo"/>
    
    <h1 class="logo logo-name">ShakeMap Documentation</h1>
    
  </a>
</p>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../manual4_0/index.html">ShakeMap 4.0 Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../programs/programs.html">ShakeMap 4.0 Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/shakemap.html">ShakeMap 4.0 API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../manual3_5/index.html">ShakeMap 3.5 Manual (Deprecated)</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
    </div>

    

    
  </body>
</html>